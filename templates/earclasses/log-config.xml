<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi:schemaLocation="
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
	
	<bean id="loggingManager" class="com.ejie.x38.log.LoggingManagerImpl" />
	
	<bean id="serviceLoggingAdvice" class="com.ejie.x38.log.ServiceLoggingAdviceImpl">
		<property name="loggingManager" ref="loggingManager"/>
	</bean>
	
	<bean id="daoLoggingAdvice" class="com.ejie.x38.log.DaoLoggingAdviceImpl">
			<property name="loggingManager" ref="loggingManager"/>
	</bean>
	
	<bean id="incidenceLoggingAdvice" class="com.ejie.x38.log.IncidenceLoggingAdviceImpl" >
		<property name="loggingManager" ref="loggingManager"/>
	</bean>
	
	<bean id="mainAdvice" class="com.ejie.x38.aop.MainAdvice">
		<property name="serviceLoggingAdvice" ref="serviceLoggingAdvice" />
		<property name="daoLoggingAdvice" ref="daoLoggingAdvice" />
		<property name="incidenceLoggingAdvice" ref="incidenceLoggingAdvice" />
	</bean>
	
	<aop:config>
		<aop:pointcut id="serviceCall"
			expression="execution(*
			com.ejie.*.service..*.*(..))" />
		<aop:aspect id="serviceLogAspect" ref="mainAdvice">
			<aop:around pointcut-ref="serviceCall" method="serviceLogCall" />
		</aop:aspect>
	</aop:config>
	
	<aop:config>
		<aop:pointcut id="daoCall"
			expression="execution(*
			com.ejie.*.dao..*.*(..))" />
		<aop:aspect id="daoLogAspect" ref="mainAdvice">
			<aop:around pointcut-ref="daoCall" method="daoLogCall" />
		</aop:aspect>
	</aop:config>

	<aop:config>
		<aop:pointcut id="incidenceCreation"
			expression="execution(* com.ejie.*.service..*.*(..)) &amp;&amp;target(target)" />
		<aop:aspect id="incidenceLogAspect" ref="mainAdvice">
			<aop:after-throwing throwing="exception"
				pointcut-ref="incidenceCreation" method="logIncidence" />
		</aop:aspect>
	</aop:config>
</beans>